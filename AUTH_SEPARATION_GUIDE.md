# üîê –†–æ–∑–¥—ñ–ª–µ–Ω–Ω—è –≤—Ö–æ–¥—ñ–≤: –ê–¥–º—ñ–Ω —Ç–∞ –ü–æ–∫—É–ø–µ—Ü—å

## –û–≥–ª—è–¥

–¢–µ–ø–µ—Ä —Å–∏—Å—Ç–µ–º–∞ –º–∞—î **–¥–≤–∞ –Ω–µ–∑–∞–ª–µ–∂–Ω–∏—Ö –≤—Ö–æ–¥–∏**, —è–∫—ñ –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—é—Ç—å –º—ñ–∂ —Å–æ–±–æ—é:

1. **–í—Ö—ñ–¥ –¥–ª—è –ø–æ–∫—É–ø—Ü—ñ–≤** - `/profile/login`
2. **–í—Ö—ñ–¥ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤** - `/admin/login`

–û–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –±—É—Ç–∏ –æ–¥–Ω–æ—á–∞—Å–Ω–æ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–π —è–∫ –ø–æ–∫—É–ø–µ—Ü—å —ñ —è–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä.

---

## üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –î–≤–∞ –æ–∫—Ä–µ–º–∏—Ö Supabase –∫–ª—ñ—î–Ω—Ç–∏

#### 1. –ö–ª—ñ—î–Ω—Ç –¥–ª—è –ø–æ–∫—É–ø—Ü—ñ–≤
**–§–∞–π–ª:** `src/lib/supabaseClient.js`
```javascript
export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
    auth: {
        storageKey: 'supabase-customer-auth', // –û–∫—Ä–µ–º–∏–π –∫–ª—é—á
        ...
    }
})
```

#### 2. –ö–ª—ñ—î–Ω—Ç –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
**–§–∞–π–ª:** `src/lib/supabaseAdminClient.js`
```javascript
export const supabaseAdmin = createClient(supabaseUrl, supabaseAnonKey, {
    auth: {
        storageKey: 'supabase-admin-auth', // –û–∫—Ä–µ–º–∏–π –∫–ª—é—á
        ...
    }
})
```

### –†—ñ–∑–Ω—ñ –∫–ª—é—á—ñ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä—ñ–∑–Ω–∏—Ö `storageKey` –æ–∑–Ω–∞—á–∞—î, —â–æ:
- –°–µ—Å—ñ—ó –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö localStorage
- –í—Ö—ñ–¥ –≤ –æ–¥–∏–Ω –∞–∫–∞—É–Ω—Ç –Ω–µ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —ñ–Ω—à–∏–π
- –ú–æ–∂–Ω–∞ –±—É—Ç–∏ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–º –æ–¥–Ω–æ—á–∞—Å–Ω–æ —è–∫ –ø–æ–∫—É–ø–µ—Ü—å —ñ —è–∫ –∞–¥–º—ñ–Ω

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª—ñ–≤

### –ü—Ä–æ—Ñ—ñ–ª—å –ø–æ–∫—É–ø—Ü—è
```
src/app/profile/
‚îú‚îÄ‚îÄ login/page.tsx          # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î supabase
‚îî‚îÄ‚îÄ page.tsx                # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î supabase
```

### –ü–∞–Ω–µ–ª—å –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```
src/app/admin/
‚îú‚îÄ‚îÄ login/page.tsx          # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î supabaseAdmin
‚îî‚îÄ‚îÄ page.tsx                # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î supabaseAdmin
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∏
```
src/components/
‚îú‚îÄ‚îÄ ImageUpload.tsx         # –ü—ñ–¥—Ç—Ä–∏–º—É—î –æ–±–∏–¥–≤–∞ –∫–ª—ñ—î–Ω—Ç–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–ø useAdminClient
‚îú‚îÄ‚îÄ EditProductModal.tsx    # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î ImageUpload –∑ useAdminClient={true}
‚îî‚îÄ‚îÄ Navbar.tsx              # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î supabase (–¥–ª—è –ø–æ–∫—É–ø—Ü—ñ–≤)
```

---

## üîë –Ø–∫ —Ü–µ –ø—Ä–∞—Ü—é—î

### –í—Ö—ñ–¥ –ø–æ–∫—É–ø—Ü—è

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –π–¥–µ –Ω–∞ `/profile/login`
2. –í–≤–æ–¥–∏—Ç—å email/password –∞–±–æ –≤—Ö–æ–¥–∏—Ç—å —á–µ—Ä–µ–∑ Google
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `supabase` –∫–ª—ñ—î–Ω—Ç
4. –°–µ—Å—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `localStorage['supabase-customer-auth']`
5. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ `/profile`

### –í—Ö—ñ–¥ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –π–¥–µ –Ω–∞ `/admin/login`
2. –í–≤–æ–¥–∏—Ç—å email/password
3. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `supabaseAdmin` –∫–ª—ñ—î–Ω—Ç
4. –ü–µ—Ä–µ–≤—ñ—Ä—è—î—Ç—å—Å—è –ø–æ–ª–µ `is_admin` –≤ —Ç–∞–±–ª–∏—Ü—ñ `profiles`
5. –°–µ—Å—ñ—è –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è –≤ `localStorage['supabase-admin-auth']`
6. –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–∞ `/admin`

### –û–¥–Ω–æ—á–∞—Å–Ω–∏–π –≤—Ö—ñ–¥

```
localStorage:
‚îú‚îÄ‚îÄ supabase-customer-auth: { user: "customer@example.com", ... }
‚îî‚îÄ‚îÄ supabase-admin-auth:    { user: "admin@example.com", ... }
```

–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ:
- –ë—É—Ç–∏ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–º —è–∫ –ø–æ–∫—É–ø–µ—Ü—å –Ω–∞ `/profile`
- –û–¥–Ω–æ—á–∞—Å–Ω–æ –±—É—Ç–∏ –∑–∞–ª–æ–≥—ñ–Ω–µ–Ω–∏–º —è–∫ –∞–¥–º—ñ–Ω –Ω–∞ `/admin`
- –í–∏—Ö–æ–¥–∏—Ç–∏ –∑ –æ–¥–Ω–æ–≥–æ –∞–∫–∞—É–Ω—Ç—É –±–µ–∑ –≤–ø–ª–∏–≤—É –Ω–∞ —ñ–Ω—à–∏–π

---

## üõ†Ô∏è –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –≤ –∫–æ–¥—ñ

### –î–ª—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –ø–æ–∫—É–ø—Ü—ñ–≤
```typescript
import { supabase } from '@/lib/supabaseClient';

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó
const { data: { session } } = await supabase.auth.getSession();

// –í–∏—Ö—ñ–¥
await supabase.auth.signOut();
```

### –î–ª—è —Å—Ç–æ—Ä—ñ–Ω–æ–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
```typescript
import { supabaseAdmin } from '@/lib/supabaseAdminClient';

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó + –ø—Ä–∞–≤–∞ –∞–¥–º—ñ–Ω–∞
const { data: { session } } = await supabaseAdmin.auth.getSession();
const { data: profile } = await supabaseAdmin
    .from('profiles')
    .select('is_admin')
    .eq('id', session.user.id)
    .single();

if (!profile?.is_admin) {
    // –ù–µ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
}

// –í–∏—Ö—ñ–¥
await supabaseAdmin.auth.signOut();
```

### –î–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –≤ –æ–±–æ—Ö –º—ñ—Å—Ü—è—Ö
```typescript
// ImageUpload.tsx
interface ImageUploadProps {
    useAdminClient?: boolean; // –ü—Ä–∞–ø–æ—Ä–µ—Ü—å –¥–ª—è –≤–∏–±–æ—Ä—É –∫–ª—ñ—î–Ω—Ç–∞
}

export default function ImageUpload({ useAdminClient = false }: ImageUploadProps) {
    const supabaseClient = useAdminClient ? supabaseAdmin : supabase;
    // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ supabaseClient –¥–ª—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
}
```

---

## ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏ —Ü—å–æ–≥–æ –ø—ñ–¥—Ö–æ–¥—É

1. **–ù–µ–∑–∞–ª–µ–∂–Ω—ñ—Å—Ç—å** - –≤—Ö–æ–¥–∏ –Ω–µ –∫–æ–Ω—Ñ–ª—ñ–∫—Ç—É—é—Ç—å
2. **–ì–Ω—É—á–∫—ñ—Å—Ç—å** - –æ–¥–∏–Ω –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –º–æ–∂–µ –º–∞—Ç–∏ –æ–±–∏–¥–≤–∞ —Ä–æ–ª—ñ
3. **–ë–µ–∑–ø–µ–∫–∞** - –∞–¥–º—ñ–Ω-—Å–µ—Å—ñ—è –≤—ñ–¥–æ–∫—Ä–µ–º–ª–µ–Ω–∞ –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ—ó
4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ —Å–∫–ª–∞–¥–Ω—ñ —Å–∏—Å—Ç–µ–º–∏ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ä–æ–ª—è–º–∏
5. **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å** - –ª–µ–≥–∫–æ –¥–æ–¥–∞—Ç–∏ –±—ñ–ª—å—à–µ —Ç–∏–ø—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

---

## üîí –ë–µ–∑–ø–µ–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

–ö–æ–∂–Ω–∞ –∞–¥–º—ñ–Ω-—Å—Ç–æ—Ä—ñ–Ω–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î:
```typescript
const { data: profile } = await supabaseAdmin
    .from('profiles')
    .select('is_admin')
    .eq('id', session.user.id)
    .single();

if (!profile?.is_admin) {
    await supabaseAdmin.auth.signOut();
    window.location.href = '/admin/login';
}
```

### Row Level Security (RLS)

–¢–∞–±–ª–∏—Ü—è `profiles` –º–∞—î –ø–æ–ª—ñ—Ç–∏–∫–∏ RLS, —è–∫—ñ:
- –î–æ–∑–≤–æ–ª—è—é—Ç—å —á–∏—Ç–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ —Å–≤—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å
- –î–æ–∑–≤–æ–ª—è—é—Ç—å –æ–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ç—ñ–ª—å–∫–∏ –∞–¥–º—ñ–Ω–∞–º

---

## üìù –ü—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ü–µ–Ω–∞—Ä—ñ–π 1: –í–ª–∞—Å–Ω–∏–∫ –º–∞–≥–∞–∑–∏–Ω—É
```
1. –í—Ö–æ–¥–∏—Ç—å —è–∫ –∞–¥–º—ñ–Ω –Ω–∞ /admin/login
2. –ö–µ—Ä—É—î —Ç–æ–≤–∞—Ä–∞–º–∏ —Ç–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è–º–∏
3. –•–æ—á–µ –∑—Ä–æ–±–∏—Ç–∏ —Ç–µ—Å—Ç–æ–≤–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
4. –í—ñ–¥–∫—Ä–∏–≤–∞—î /profile/login –≤ —ñ–Ω—à—ñ–π –≤–∫–ª–∞–¥—Ü—ñ
5. –í—Ö–æ–¥–∏—Ç—å —è–∫ –ø–æ–∫—É–ø–µ—Ü—å
6. –†–æ–±–∏—Ç—å –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
7. –û–±–∏–¥–≤—ñ —Å–µ—Å—ñ—ó –∞–∫—Ç–∏–≤–Ω—ñ –æ–¥–Ω–æ—á–∞—Å–Ω–æ
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 2: –ó–≤–∏—á–∞–π–Ω–∏–π –ø–æ–∫—É–ø–µ—Ü—å
```
1. –í—Ö–æ–¥–∏—Ç—å –Ω–∞ /profile/login
2. –ü–µ—Ä–µ–≥–ª—è–¥–∞—î —Å–≤–æ—ó –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
3. –ù–µ –º–∞—î –¥–æ—Å—Ç—É–ø—É –¥–æ /admin (–Ω–µ–º–∞—î is_admin)
```

### –°—Ü–µ–Ω–∞—Ä—ñ–π 3: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä
```
1. –í—Ö–æ–¥–∏—Ç—å –Ω–∞ /admin/login
2. –ö–µ—Ä—É—î –º–∞–≥–∞–∑–∏–Ω–æ–º
3. –ú–æ–∂–µ —Ç–∞–∫–æ–∂ —É–≤—ñ–π—Ç–∏ —è–∫ –ø–æ–∫—É–ø–µ—Ü—å –æ–∫—Ä–µ–º–æ
```

---

## üöÄ –ú–∞–π–±—É—Ç–Ω—ñ –ø–æ–∫—Ä–∞—â–µ–Ω–Ω—è

–ú–æ–∂–ª–∏–≤—ñ –¥–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–æ–ª—ñ:
- **–ú–µ–Ω–µ–¥–∂–µ—Ä** - –æ–±—Ä–æ–±–∫–∞ –∑–∞–º–æ–≤–ª–µ–Ω—å, –∞–ª–µ –±–µ–∑ –¥–æ—Å—Ç—É–ø—É –¥–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å
- **–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä** - –∫–µ—Ä—É–≤–∞–Ω–Ω—è –∫–æ–Ω—Ç–µ–Ω—Ç–æ–º
- **–ê–Ω–∞–ª—ñ—Ç–∏–∫** - —Ç—ñ–ª—å–∫–∏ –ø–µ—Ä–µ–≥–ª—è–¥ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

–î–ª—è —Ü—å–æ–≥–æ –º–æ–∂–Ω–∞:
1. –°—Ç–≤–æ—Ä–∏—Ç–∏ –Ω–æ–≤—ñ –∫–ª—ñ—î–Ω—Ç–∏ –∑ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–º–∏ `storageKey`
2. –î–æ–¥–∞—Ç–∏ –Ω–æ–≤—ñ –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—é `profiles` (is_manager, is_moderator)
3. –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –≤—Ö–æ–¥—É

---

## üìö –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Ä–µ—Å—É—Ä—Å–∏

- [Supabase Auth Documentation](https://supabase.com/docs/guides/auth)
- [Multiple Auth Instances](https://supabase.com/docs/reference/javascript/initializing#creating-multiple-clients)
- [Row Level Security](https://supabase.com/docs/guides/auth/row-level-security)

---

## ‚ö†Ô∏è –í–∞–∂–ª–∏–≤–æ

- **–ù–µ –∑–º—ñ—à—É–π—Ç–µ –∫–ª—ñ—î–Ω—Ç–∏** - –∑–∞–≤–∂–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∫–ª—ñ—î–Ω—Ç –¥–ª—è –∫–æ–∂–Ω–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –¥–æ–¥–∞—Ç–∫—É
- **–ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞** - –∑–∞–≤–∂–¥–∏ –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ `is_admin` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ
- **–ó–∞—Ö–∏—â–∞–π—Ç–µ API** - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ RLS —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É –ø—Ä–∞–≤ –≤ API routes
- **–¢–µ—Å—Ç—É–π—Ç–µ** - –ø–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –æ–±–∏–¥–≤–∞ —Ç–∏–ø–∏ –≤—Ö–æ–¥—É –ø—ñ—Å–ª—è –∑–º—ñ–Ω

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –í—Ö—ñ–¥ –≤ –∞–¥–º—ñ–Ω–∫—É –≤–∏—Ö–æ–¥–∏—Ç—å –∑ –ø—Ä–æ—Ñ—ñ–ª—é –ø–æ–∫—É–ø—Ü—è
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è `supabaseAdmin`, –∞ –Ω–µ `supabase`

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –º–æ–∂—É –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤ –∞–¥–º—ñ–Ω—Ü—ñ
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ `ImageUpload` –æ—Ç—Ä–∏–º—É—î `useAdminClient={true}`

### –ü—Ä–æ–±–ª–µ–º–∞: –°–µ—Å—ñ—è –∑–Ω–∏–∫–∞—î –ø—ñ—Å–ª—è –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
**–†—ñ—à–µ–Ω–Ω—è:** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ, —â–æ `persistSession: true` –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –∫–ª—ñ—î–Ω—Ç–∞

---

–°—Ç–≤–æ—Ä–µ–Ω–æ: 30 –ª–∏—Å—Ç–æ–ø–∞–¥–∞ 2025
