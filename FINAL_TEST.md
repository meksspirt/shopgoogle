# ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç - –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

1. ‚úÖ **Middleware –æ—Ç–∫–ª—é—á–µ–Ω** - —Ç–µ–ø–µ—Ä—å –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–æ—Å—Ç—É–ø
2. ‚úÖ **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `window.location.href`** - –Ω–∞–¥–µ–∂–Ω—ã–π —Ä–µ–¥–∏—Ä–µ–∫—Ç
3. ‚úÖ **–ö–ª–∏–µ–Ω—Ç—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞** - –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –∫–ª–∏–µ–Ω—Ç–∞
4. ‚úÖ **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –≤–∏–¥–Ω–æ –∫–∞–∂–¥—ã–π —à–∞–≥

## –¢–µ—Å—Ç 1: –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É

### –®–∞–≥–∏:

1. **–û—Ç–∫—Ä–æ–π—Ç–µ** `http://localhost:3000/admin/login`
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å** (F12 ‚Üí Console)
3. **–í–≤–µ–¥–∏—Ç–µ** email –∏ –ø–∞—Ä–æ–ª—å
4. **–ù–∞–∂–º–∏—Ç–µ** "–£–≤—ñ–π—Ç–∏"

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

**–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```
üîê –°–ø—Ä–æ–±–∞ –≤—Ö–æ–¥—É... { email: "–≤–∞—à-email" }
‚úÖ Supabase auth —É—Å–ø—ñ—à–Ω–∞: user-id
üì° –í—ñ–¥–ø–æ–≤—ñ–¥—å API: 200
üì¶ –î–∞–Ω—ñ API: { success: true, session: {...}, user: {...} }
‚úÖ –£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥, —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ /admin
```

**–ó–∞—Ç–µ–º:**
- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
- –û—Ç–∫—Ä–æ–µ—Ç—Å—è `/admin` —Å –ø–∞–Ω–µ–ª—å—é –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
- –í—ã —É–≤–∏–¥–∏—Ç–µ –∑–∞–∫–∞–∑—ã, —Ç–æ–≤–∞—Ä—ã, –ø—Ä–æ–º–æ–∫–æ–¥—ã

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ (–≥–¥–µ npm run dev):**
```
üîê API Login attempt for: –≤–∞—à-email
‚úÖ User authenticated: user-id
üë§ Profile check: { profile: { is_admin: true }, profileError: null }
‚úÖ Admin access granted
```

## –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ `/admin`:

**–í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:**
```
üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó...
üìã –°–µ—Å—ñ—è: { session: true, error: null }
‚úÖ –°–µ—Å—ñ—è –∑–Ω–∞–π–¥–µ–Ω–∞, –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞...
üë§ User ID: –≤–∞—à-user-id
üìä –ü—Ä–æ—Ñ—ñ–ª—å: { profile: { is_admin: true }, error: null }
‚úÖ –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–æ, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö...
```

**–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:**
- ‚úÖ –í–∏–¥–Ω—ã –∑–∞–∫–∞–∑—ã
- ‚úÖ –í–∏–¥–Ω—ã —Ç–æ–≤–∞—Ä—ã
- ‚úÖ –í–∏–¥–Ω—ã –ø—Ä–æ–º–æ–∫–æ–¥—ã
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "–í–∏–π—Ç–∏" —Ä–∞–±–æ—Ç–∞–µ—Ç

## –¢–µ—Å—Ç 3: –í—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

1. **–ù–∞–∂–º–∏—Ç–µ** –∫–Ω–æ–ø–∫—É "–í–∏–π—Ç–∏" –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
2. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/login`
   - –°–µ—Å—Å–∏—è —É–¥–∞–ª–µ–Ω–∞

## –¢–µ—Å—Ç 4: –ó–∞—â–∏—Ç–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

1. **–í—ã–π–¥–∏—Ç–µ** –∏–∑ —Å–∏—Å—Ç–µ–º—ã
2. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ** –æ—Ç–∫—Ä—ã—Ç—å `http://localhost:3000/admin` –Ω–∞–ø—Ä—è–º—É—é
3. **–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
   - –í –∫–æ–Ω—Å–æ–ª–∏: `‚ùå –ù–µ–º–∞—î —Å–µ—Å—ñ—ó, —Ä–µ–¥—ñ—Ä–µ–∫—Ç –Ω–∞ –ª–æ–≥—ñ–Ω`
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ `/admin/login`

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –≤—Ö–æ–¥–∞ –æ—Å—Ç–∞—é—Å—å –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ª–æ–≥–∏–Ω–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å "‚úÖ –£—Å–ø—ñ—à–Ω–∏–π –≤—Ö—ñ–¥"
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—Ä—É—á–Ω—É—é –æ—Ç–∫—Ä—ã—Ç—å `/admin` –≤ –Ω–æ–≤–æ–π –≤–∫–ª–∞–¥–∫–µ
4. –û—á–∏—Å—Ç–∏—Ç–µ –∫–µ—à –±—Ä–∞—É–∑–µ—Ä–∞ (Ctrl+Shift+Delete)

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /admin –ø–∏—à–µ—Ç "–ù–µ–º–∞—î —Å–µ—Å—ñ—ó"

**–†–µ—à–µ–Ω–∏–µ:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ /admin/login –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
const { data } = await supabase.auth.getSession();
console.log('Session:', data.session);
console.log('Access token:', data.session?.access_token);
```

–ï—Å–ª–∏ `session` –µ—Å—Ç—å, –Ω–æ –Ω–∞ `/admin` –µ–≥–æ –Ω–µ—Ç - –ø—Ä–æ–±–ª–µ–º–∞ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –º–µ–∂–¥—É —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏.

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ –Ω–∞ /admin/login
localStorage.clear();
sessionStorage.clear();
// –ó–∞—Ç–µ–º –≤–æ–π–¥–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞: "–ü–æ–º–∏–ª–∫–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –ø—Ä–æ—Ñ—ñ–ª—é"

**–†–µ—à–µ–Ω–∏–µ:**
```sql
-- –í Supabase SQL Editor
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
SELECT * FROM public.profiles WHERE email = '–≤–∞—à-email';

-- –ï—Å–ª–∏ is_admin = false, –∏—Å–ø—Ä–∞–≤—å—Ç–µ
UPDATE public.profiles SET is_admin = TRUE WHERE email = '–≤–∞—à-email';
```

## –ë—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:

```javascript
// –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ /admin/login –ø–æ—Å–ª–µ –≤—Ö–æ–¥–∞
(async () => {
    console.log('=== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê ===');
    
    // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏
    const { data: { session }, error } = await supabase.auth.getSession();
    console.log('1. –°–µ—Å—ñ—è:', !!session, error);
    
    if (!session) {
        console.log('‚ùå –ù–µ–º–∞—î —Å–µ—Å—ñ—ó!');
        return;
    }
    
    // 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è
    const { data: profile, error: profileError } = await supabase
        .from('profiles')
        .select('*')
        .eq('id', session.user.id)
        .single();
    
    console.log('2. –ü—Ä–æ—Ñ—ñ–ª—å:', profile, profileError);
    
    // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
    console.log('3. –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä:', profile?.is_admin);
    
    // 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ cookies
    console.log('4. Cookies:', document.cookie.includes('sb-'));
    
    // 5. –ò—Ç–æ–≥
    if (session && profile?.is_admin) {
        console.log('‚úÖ –í–°–ï –û–ö! –ú–æ–∂–Ω–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç–∏ –Ω–∞ /admin');
        window.location.href = '/admin';
    } else {
        console.log('‚ùå –©–æ—Å—å –Ω–µ —Ç–∞–∫:', {
            hasSession: !!session,
            hasProfile: !!profile,
            isAdmin: profile?.is_admin
        });
    }
})();
```

## –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤:

‚úÖ –í—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ /admin –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç  
‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è  
‚úÖ –î–∞–Ω–Ω—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è  
‚úÖ –í—ã—Ö–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç  
‚úÖ –ó–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–±–µ–∑ –≤—Ö–æ–¥–∞ –Ω–µ–ª—å–∑—è –ø–æ–ø–∞—Å—Ç—å –≤ –∞–¥–º–∏–Ω–∫—É)

## –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä:**
   ```bash
   # Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏
   npm run dev
   ```

2. **–û—á–∏—Å—Ç–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä:**
   - Ctrl+Shift+Delete
   - –û—á–∏—Å—Ç–∏—Ç–µ cookies –∏ –∫–µ—à
   - –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ —Å localhost

3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ:**
   - Ctrl+Shift+N (Chrome)
   - Ctrl+Shift+P (Firefox)

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase:**
   - Dashboard ‚Üí Authentication ‚Üí Users
   - –í–∞—à –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–∞–º
   - Dashboard ‚Üí SQL Editor ‚Üí –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
     ```sql
     SELECT * FROM public.profiles WHERE email = '–≤–∞—à-email';
     ```
   - `is_admin` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `true`

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫:

- [ ] Dev —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω (`npm run dev`)
- [ ] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ Supabase
- [ ] `is_admin = TRUE` –≤ —Ç–∞–±–ª–∏—Ü–µ profiles
- [ ] –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞ (F12)
- [ ] –ù–µ—Ç –∫—Ä–∞—Å–Ω—ã—Ö –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ `.env.local` –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- [ ] –¢–∞–±–ª–∏—Ü–∞ `profiles` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- [ ] –§—É–Ω–∫—Ü–∏—è `is_admin()` —Å–æ–∑–¥–∞–Ω–∞
- [ ] RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã

–ï—Å–ª–∏ –≤—Å–µ –ø—É–Ω–∫—Ç—ã –æ—Ç–º–µ—á–µ–Ω—ã, –≤—Ö–æ–¥ –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å! üéâ
