# Інтеграція віджету Нової Пошти

## Що було зроблено

### 1. Створено компонент NovaPoshtaWidget
- Файл: `src/components/NovaPoshtaWidget.tsx`
- Інтегрує офіційний віджет Нової Пошти
- Підтримує геолокацію для автоматичного визначення міста
- Стилізований під дизайн сайту

### 2. Оновлено сторінку чекауту
- Файл: `src/app/checkout/page.tsx`
- Замінено поля вводу міста та відділення на віджет
- Додано валідацію: кнопка оплати неактивна, поки не обрано відділення
- Зберігається повна інформація про доставку:
  - Місто
  - Назва відділення
  - ID відділення (для API Нової Пошти)
  - Повна адреса

### 3. Оновлено адмінку
- Файл: `src/app/admin/page.tsx`
- Відображається повна інформація про доставку:
  - Місто
  - Відділення Нової Пошти
  - ID відділення (для інтеграції з API НП)
  - Повна адреса відділення

### 4. Додано стилі
- Файл: `src/app/globals.css`
- Віджет стилізований під загальний дизайн сайту
- Адаптивний дизайн для мобільних пристроїв

### 5. SQL міграція
- Файл: `supabase/add_nova_poshta_warehouse_id.sql`
- Додано поле `nova_poshta_warehouse_id` в таблицю `orders`

## Інструкція з встановлення

### Крок 1: Оновити базу даних
Виконайте SQL міграцію в Supabase:

```sql
-- Відкрийте Supabase Dashboard -> SQL Editor
-- Скопіюйте та виконайте вміст файлу:
-- supabase/add_nova_poshta_warehouse_id.sql

ALTER TABLE orders 
ADD COLUMN IF NOT EXISTS nova_poshta_warehouse_id TEXT;

COMMENT ON COLUMN orders.nova_poshta_warehouse_id IS 'ID відділення Нової Пошти з віджету';
```

### Крок 2: Перевірити роботу
1. Перейдіть на сторінку оформлення замовлення
2. Натисніть на віджет Нової Пошти
3. Оберіть місто та відділення
4. Перевірте, що інформація відображається коректно
5. Оформіть тестове замовлення
6. Перевірте в адмінці, що всі дані про доставку збережені

## Особливості віджету

### Функціонал
- ✅ Автоматичне визначення міста за геолокацією
- ✅ Пошук відділень та поштоматів
- ✅ Відображення на карті
- ✅ Фільтрація за типом відділення
- ✅ Збереження ID відділення для API інтеграції

### Дизайн
- ✅ Стилізований під дизайн сайту
- ✅ Темна тема
- ✅ Адаптивний для мобільних
- ✅ Плавні анімації та переходи

### Валідація
- ✅ Обов'язкове поле
- ✅ Кнопка оплати неактивна без вибору відділення
- ✅ Відображення помилки, якщо не обрано відділення

## Подальша інтеграція з API Нової Пошти

Збережений `nova_poshta_warehouse_id` можна використовувати для:
- Автоматичного створення ТТН через API Нової Пошти
- Розрахунку вартості доставки
- Відстеження посилок
- Друку накладних

Документація API: https://developers.novaposhta.ua/

## Підтримка

Віджет використовує офіційний віджет Нової Пошти:
- URL: https://widget.novapost.com/division/index.html
- Документація: https://developers.novaposhta.ua/pages/instrukciya-z-integraciyi-widget-viboru-pidrozdilu-dostavki
